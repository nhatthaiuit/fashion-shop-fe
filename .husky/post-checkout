# post-checkout (portable, no-fail if npm missing)
# Husky v10+: khÃ´ng cáº§n source husky.sh

echo "ðŸ”§ post-checkout: installing deps..."

# 1) Náº¿u khÃ´ng cÃ³ package.json thÃ¬ bá» qua
if [ ! -f "package.json" ]; then
  echo "â„¹ï¸  No package.json -> skip."
  exit 0
fi

# (tÃ¹y chá»n cho mac Homebrew)
export PATH="/opt/homebrew/bin:/usr/local/bin:$PATH"

# 2) Thá»­ tÃ¬m trÃ¬nh quáº£n lÃ½ gÃ³i (Æ°u tiÃªn npm, fallback yarn/pnpm)
PKG=""
if command -v npm >/dev/null 2>&1; then
  PKG="npm"
elif command -v yarn >/dev/null 2>&1; then
  PKG="yarn"
elif command -v pnpm >/dev/null 2>&1; then
  PKG="pnpm"
fi

# 3) Náº¿u khÃ´ng tÃ¬m tháº¥y, KHÃ”NG fail (giá»¯ cho GitHub Desktop/mac sáº¡ch lá»—i)
if [ -z "$PKG" ]; then
  echo "â„¹ï¸  No npm/yarn/pnpm in PATH -> skip install (won't fail)."
  exit 0
fi

# 4) CÃ i deps (ci náº¿u cÃ³, fallback install). Táº¥t cáº£ Ä‘á»u im láº·ng náº¿u khÃ´ng lockfile tÆ°Æ¡ng á»©ng.
if [ "$PKG" = "npm" ]; then
  npm ci >/dev/null 2>&1 || npm install
elif [ "$PKG" = "yarn" ]; then
  yarn install --frozen-lockfile >/dev/null 2>&1 || yarn install
else
  pnpm install --frozen-lockfile >/dev/null 2>&1 || pnpm install
fi
